### 运行时常量池

[jvm-book:关于运行常量池的一个issue](https://github.com/fenixsoft/jvm_book/issues/112)

[javaGuide:关于运行常量池的一个issue](https://github.com/Snailclimb/JavaGuide/issues/747)

> 运行时常量池是方法区的一部分。Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有常量池表（用于存放编译期生成的各种字面量和符号引用  



> 运行时常量池相对于Class文件常量池的另外一个重要特征是具备动态性，Java语言并不要求常量 一定只有编译期才能产生，也就是说，**并非预置入Class文件中常量池的内容才能进入方法区运行时常量池**，运行期间也可以将新的常量放入池中，这种特性被开发人员利用得比较多的便是String类的 intern()方法。



> 1. JDK1.7 之前运行时常量池逻辑包含字符串常量池存放在方法区, 此时 hotspot 虚拟机对方法区的实现为永久代
> 2. **JDK1.7 把字符串常量池和静态变量等从方法区拿到堆**
> 3. JDK1.8 hotspot 移除了永久代用元空间(Metaspace)取而代之, 方法区的实现从永久代变成了元空间(Metaspace)



> “JDK 8后，HotSpot虚拟机已经不再使用以前PermGen来实现方法区了，类型信息挪到Metaspace，类变量、字面量等信息挪到了Heap中了”。
>
> 运行时常量池、方法区、字符串常量池这些都是不随虚拟机实现而改变的逻辑概念，是公共且抽象的，Metaspace、Heap是与具体某种虚拟机实现相关的物理概念，是私有且具体的。
>
> 虚拟机规范提倡的理念是“公有设计，私有实现”，我们可以说“目前版本的HotSpot没有将字符串常量池放在元空间中"，但是不能说“现在的JVM不再将字符串常量池放在方法区中”。无论是哪一种Java虚拟机，无论它是使用PermGen（8之前的HS），还是JavaHeap（8之后的HS），抑或是CHeap（J9）来存放字面量，都不影响字符串常量仍然是运行时常量的一个子集，因为它们都是逻辑上的概念，所有Java虚拟机一致的外观。
>
> 其实“字符串常量池”这个说法，也是因为HotSpot本身实现了这个概念，大家已经形成习惯。其实在JVMS中只陈述了字面量应该不重复地存储在运行时常量池之中，并没有定义过字符串常量“池”的概念。
